(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{k:()=>w,V:()=>A});var t=document.querySelector("#profile-popup"),n=document.querySelector("#add-card-popup"),o=document.querySelectorAll(".popup__container-close-btn"),r={openPopup:function(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",c),window.addEventListener("keydown",a)},closePopup:u,popupProfile:t,popupAddCard:n,popupAvatar:document.querySelector("#change-avatar")};o.forEach((function(e){e.addEventListener("mousedown",c)}));var c=function(e){var t=document.querySelector(".popup_opened"),n=e.target.classList.contains("popup"),o=e.target.classList.contains("popup__container-close-btn");(n||o)&&u(t)},a=function(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&u(t)};function u(e){e.removeEventListener("mousedown",c),window.removeEventListener("keydown",a),e.classList.remove("popup_opened")}var i="plus-cohort-23",l="https://nomoreparties.co/v1/",s="020effc4-1211-4deb-93d9-11a33dcdf1a5",d={getProfileData:function(){return fetch("".concat(l).concat(i,"/users/me"),{headers:{authorization:s}})},getCards:p,editProfileData:function(e,t){return fetch("".concat(l).concat(i,"/users/me"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})})},sendNewCard:function(e,t){return fetch("".concat(l).concat(i,"/cards"),{method:"POST",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})})},deleteCard:function(e){return fetch("".concat(l).concat(i,"/cards/").concat(e),{method:"DELETE",headers:{authorization:s}})},setLike:function(e){return fetch("".concat(l).concat(i,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:s}})},removeLike:function(e){return fetch("".concat(l).concat(i,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:s}})},getCardData:function(e){return p().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){for(var n=0;n<t.length;n++)if(t[n]._id===e)return t[n]})).catch((function(e){return console.log(e)}))},changeAvatar:function(e){return fetch("".concat(l).concat(i,"/users/me/avatar"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})})}};function p(){return fetch("".concat(l).concat(i,"/cards"),{headers:{authorization:s}})}var f=document.querySelector("#card-template").content,v=document.querySelector("#pict-popup"),m=document.querySelector(".popup__full-pict"),_="gallery-card__like_active",y="gallery-card__like",h={createCard:function(e){var t=function(e){var t,n=f.querySelector(".gallery-card-list-element").cloneNode(!0),o=n.querySelector(".gallery-card__pict");return o.src=e.link,o.alt="Фотография места: ".concat(e.name),n.querySelector(".gallery-card__label-text").textContent=e.name,(t=o).addEventListener("click",(function(){r.openPopup(v),m.src=t.src,m.alt="Фотография места"})),n}(e);if(t.querySelector(".".concat(y)).addEventListener("click",(function(){var n,o;n=t,o=e._id,d.getCardData(o).then((function(e){!1===S(e)?d.setLike(o).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){k(n,!0),g(n,e.likes.length)})).catch((function(e){return console.log(e)})):d.removeLike(o).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){g(n,e.likes.length),k(n,!1)})).catch((function(e){return console.log(e)}))}))})),function(e){return e.owner._id===w}(e)){var n=t.querySelector(".gallery-card__delete");n.classList.remove("gallery-card__delete_restrict"),n.addEventListener("click",(function(){!function(e,t){d.deleteCard(e._id).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status));t.remove()}))}(e,t)}))}return t},setLikeCountToCard:g,renderLike:k,isItLikeOwner:S};function S(e){var t=e.likes;if(0===e.likes.length)return!1;for(var n=0;n<t.length;n++)if(t[n]._id===w)return!0;return!1}function g(e,t){e.querySelector(".gallery-card__like-count").textContent=t}function k(e,t){var n=e.querySelector(".".concat(y));t?n.classList.add(_):n.classList.remove(_)}var C=function(e){e.forEach((function(e){j(e,!0)}))},q=function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t,n){var o=Array.from(e.querySelectorAll(t)),r=e.querySelector(n);o.forEach((function(n){var o=document.querySelector("#".concat(n.id,"-error"));n.addEventListener("input",(function(){!function(e,t,n,o,r){!function(e,t){var n=E(e);!0===n.validState?b(e,t):P(e,t,n.errorMessage)}(t,o);var c=e.querySelectorAll(n);j(r,!1),c.forEach((function(e){!1===E(e).validState&&j(r,!0)}))}(e,n,t,o,r)}))}))}(t,e.inputSelector,e.submitButtonSelector,e.errorContainerSelector)}))},L=/[^a-zа-я\s\-]/i;function E(e,t){return"text"===e.getAttribute("type")?function(e){var t=L.test(e.value);return!1===e.validity.valid?{validState:e.validity.valid,errorMessage:e.validationMessage}:t?{validState:!1,errorMessage:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"}:{validState:!0,errorMessage:""}}(e):"url"===e.getAttribute("type")?function(e){return{validState:e.validity.valid,errorMessage:e.validationMessage}}(e):void 0}function P(e,t,n){e.classList.add(A.inputErrorStyleSelector),t.textContent=n}function b(e,t){e.classList.remove(A.inputErrorStyleSelector),t.textContent=""}function j(e,t){e.disabled=t}var A={formSelector:".popup__container-form",inputSelector:".popup__container-input",submitButtonSelector:".popup__container-save-btn",errorContainerSelector:".popup__container-input-error-message",inputErrorStyleSelector:"popup__container-input_error"},w="",x=document.querySelector(".gallery"),D=document.querySelector(".popup__container-input_field_place"),T=document.querySelector(".popup__container-input_field_pict"),z=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),M=document.querySelector(".profile__overlay"),N=document.querySelector(".popup__container-input_field_avatar"),B=document.querySelector(".popup__container-input_field_name"),F=document.querySelector(".popup__container-input_field_major"),J=document.querySelector(".profile__name"),H=document.querySelector(".profile__major"),I=document.querySelectorAll(A.submitButtonSelector+".default-disabled"),U="Сохранение...",V="",G="";function K(e,t,n,o){w=n,J.textContent=e,H.textContent=t,R(o)}function Q(e){x.prepend(e)}function R(e){document.querySelector(".profile__pict").setAttribute("src",e)}function W(e,t,n){G=n,e.textContent=t}function X(e){e.textContent=G}cardForm.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(A.submitButtonSelector);W(t,U,e.target.textContent),d.sendNewCard(T.value,D.value).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){Q(h.createCard(e))})).catch((function(e){return console.log(e)})).finally((function(){r.closePopup(r.popupAddCard),cardForm.reset(),X(t)}))})),profileForm.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(A.submitButtonSelector);W(t,U,e.target.textContent),d.editProfileData(B.value,F.value).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return K(B.value,F.value,w,V)})).catch((function(e){return console.log(e)})).finally((function(){r.closePopup(r.popupProfile),X(t)}))})),avatarForm.addEventListener("submit",(function(e){e.preventDefault();var t=N.value;d.changeAvatar(t).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status));R(t)})).catch((function(e){return console.log(e)})).finally((function(){r.closePopup(r.popupAvatar)}))})),z.addEventListener("click",(function(){r.openPopup(r.popupProfile),B.value=J.textContent,F.value=H.textContent})),O.addEventListener("click",(function(){r.openPopup(r.popupAddCard)})),M.addEventListener("click",(function(){r.openPopup(r.popupAvatar)})),q(A),C(I),d.getProfileData().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){K(e.name,e.about,e._id,e.avatar),V=e.avatar})).catch((function(e){return console.log(e)})),d.getCards().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return function(e){(e=e.reverse()).forEach((function(e){var t=h.createCard(e);Q(t),h.setLikeCountToCard(t,e.likes.length),h.isItLikeOwner(e)&&h.renderLike(t,!0)}))}(e)})).catch((function(e){return console.log(e)}))})();